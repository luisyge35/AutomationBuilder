"use strict";module.exports=function(t){require("source-map-support").install();var i=require("./core/opcua-iiot-core-response");t.nodes.registerType("OPCUA-IIoT-Response",function(e){t.nodes.createNode(this,e),this.name=e.name,this.compressStructure=e.compressStructure,this.showStatusActivities=e.showStatusActivities,this.showErrors=e.showErrors,this.activateUnsetFilter=e.activateUnsetFilter,this.activateFilters=e.activateFilters,this.negateFilter=e.negateFilter,this.filters=e.filters;var o=this;o.bianco=i.core.createBiancoIIoT(),i.core.assert(o.bianco.iiot),o.status({fill:"green",shape:"ring",text:"active"}),o.bianco.iiot.handleBrowserMsg=function(e){return i.analyzeBrowserResults(o,e),o.compressStructure&&i.compressBrowseMessageStructure(e),e},o.bianco.iiot.handleCrawlerMsg=function(e){return i.analyzeCrawlerResults(o,e),o.compressStructure&&i.compressCrawlerMessageStructure(e),e},o.bianco.iiot.handleReadMsg=function(e){return i.analyzeReadResults(o,e),o.compressStructure&&i.compressReadMessageStructure(e),e},o.bianco.iiot.handleWriteMsg=function(e){return i.analyzeWriteResults(o,e),o.compressStructure&&i.compressWriteMessageStructure(e),e},o.bianco.iiot.handleListenerMsg=function(e){return i.analyzeListenerResults(o,e),o.compressStructure&&i.compressListenMessageStructure(e),e},o.bianco.iiot.handleMethodMsg=function(e){return i.analyzeMethodResults(o,e),o.compressStructure&&i.compressMethodMessageStructure(e),e},o.bianco.iiot.handleDefaultMsg=function(e){return e&&e.payload&&(i.handlePayloadStatusCode(o,e),o.compressStructure&&i.compressDefaultMessageStructure(e)),e},o.bianco.iiot.handleNodeTypeOfMsg=function(e){var t=Object.assign({},e);switch(e.nodetype){case"browse":t=o.bianco.iiot.handleBrowserMsg(t);break;case"crawl":t=o.bianco.iiot.handleCrawlerMsg(t);break;case"read":t=o.bianco.iiot.handleReadMsg(t);break;case"write":t=o.bianco.iiot.handleWriteMsg(t);break;case"listen":t=o.bianco.iiot.handleListenerMsg(t);break;case"method":t=o.bianco.iiot.handleMethodMsg(t);break;default:t=o.bianco.iiot.handleDefaultMsg(t)}return t},o.bianco.iiot.extractReadEntriesFromFilter=function(e){var r=[],i=[];return e.payload&&e.payload.length&&e.payload.forEach(function(e,t){o.bianco.iiot.itemIsNotToFilter(e)&&(r.push(e),i.push(t))}),e.nodesToRead&&(e.nodesToRead=e.nodesToRead.filter(function(e,t){return i.includes(t)})),r},o.bianco.iiot.extractBrowserEntriesFromFilter=function(e){var t=[];return e.payload.browserResults.forEach(function(e){o.bianco.iiot.itemIsNotToFilter(e)&&t.push(e)}),t},o.bianco.iiot.extractCrawlerEntriesFromFilter=function(e){var t=[];return e.payload.crawlerResults.forEach(function(e){o.bianco.iiot.itemIsNotToFilter(e)&&t.push(e)}),t},o.bianco.iiot.extractPayloadEntriesFromFilter=function(e){var t=[];return e.payload.forEach(function(e){o.bianco.iiot.itemIsNotToFilter(e)&&t.push(e)}),t},o.bianco.iiot.extractMethodEntriesFromFilter=function(e){var r=[],i=[];e.addressSpaceItems.forEach(function(e,t){o.bianco.iiot.itemIsNotToFilter(e)&&(r.push(e),i.push(t))});var t=null;return(t=e.payload.results?e.payload.results.outputArguments:e.payload.outputArguments)&&t.forEach(function(e,t){o.bianco.iiot.itemIsNotToFilter(e)&&i.includes(t)&&(r[t].dataType=e.dataType,r[t].arrayType=e.arrayType,r[t].value=e.value)}),r},o.bianco.iiot.extractEntries=function(e){switch(e.nodetype){case"read":return o.bianco.iiot.extractReadEntriesFromFilter(e);case"browse":return o.bianco.iiot.extractBrowserEntriesFromFilter(e);case"crawl":return o.bianco.iiot.extractCrawlerEntriesFromFilter(e);case"method":return o.bianco.iiot.extractMethodEntriesFromFilter(e);default:return o.bianco.iiot.extractPayloadEntriesFromFilter(e)}},o.bianco.iiot.filterMsg=function(e){if(e.payload.length||i.core.isNodeTypeToFilterResponse(e)){var t=o.bianco.iiot.extractEntries(e);if(t.length)return e.payload=t,e}else if(o.bianco.iiot.itemIsNotToFilter(e.payload))return e;return null},o.on("input",function(t){try{if(o.activateUnsetFilter&&(void 0===t.payload||null===t.payload||t.payload==={}))return;var e=o.bianco.iiot.handleNodeTypeOfMsg(t);e.compressed=o.compressStructure,o.activateFilters&&o.filters&&0<o.filters.length?(e=o.bianco.iiot.filterMsg(e))&&o.send(e):o.send(e)}catch(e){i.internalDebugLog(e),o.showErrors&&o.error(e,t)}}),o.bianco.iiot.itemIsNotToFilter=function(t){var r=i.core.checkItemForUnsetState(o,t);return o.filters.forEach(function(e){r=i.core.checkResponseItemIsNotToFilter(o,t,e,r)}),o.negateFilter?!r:r}})};
//# sourceMappingURL=maps/opcua-iiot-response.js.map
