"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}require("source-map-support").install();var de=de||{biancoroyal:{opcua:{iiot:{core:{}}}}};de.biancoroyal.opcua.iiot.core.nodeOPCUA=de.biancoroyal.opcua.iiot.core.nodeOPCUA||require("node-opcua"),de.biancoroyal.opcua.iiot.core.nodeOPCUAId=de.biancoroyal.opcua.iiot.core.nodeOPCUAId||require("node-opcua-nodeid"),de.biancoroyal.opcua.iiot.core.internalDebugLog=de.biancoroyal.opcua.iiot.core.internalDebugLog||require("debug")("opcuaIIoT:core"),de.biancoroyal.opcua.iiot.core.detailDebugLog=de.biancoroyal.opcua.iiot.core.detailDebugLog||require("debug")("opcuaIIoT:core:details"),de.biancoroyal.opcua.iiot.core.specialDebugLog=de.biancoroyal.opcua.iiot.core.specialDebugLog||require("debug")("opcuaIIoT:core:special"),de.biancoroyal.opcua.iiot.core.OBJECTS_ROOT=de.biancoroyal.opcua.iiot.core.OBJECTS_ROOT||"ns=0;i=84",de.biancoroyal.opcua.iiot.core.TEN_SECONDS_TIMEOUT=de.biancoroyal.opcua.iiot.core.TEN_SECONDS_TIMEOUT||10,de.biancoroyal.opcua.iiot.core.RUNNING_STATE=de.biancoroyal.opcua.iiot.core.RUNNING_STATE||"SESSIONACTIVE",de.biancoroyal.opcua.iiot.core.os=de.biancoroyal.opcua.iiot.core.os||require("os"),de.biancoroyal.opcua.iiot.core.assert=de.biancoroyal.opcua.iiot.core.assert||require("better-assert"),de.biancoroyal.opcua.iiot.core.underscore=de.biancoroyal.opcua.iiot.core.underscore||require("underscore"),de.biancoroyal.opcua.iiot.core.isWindows=de.biancoroyal.opcua.iiot.core.isWindows||/^win/.test(de.biancoroyal.opcua.iiot.core.os.platform()),de.biancoroyal.opcua.iiot.core.FAKTOR_SEC_TO_MSEC=de.biancoroyal.opcua.iiot.core.FAKTOR_SEC_TO_MSEC||1e3,de.biancoroyal.opcua.iiot.core.DEFAULT_TIMEOUT=de.biancoroyal.opcua.iiot.core.DEFAULT_TIMEOUT||1e3,de.biancoroyal.opcua.iiot.core.internalDebugLog(de.biancoroyal.opcua.iiot.core.os.endianness()),de.biancoroyal.opcua.iiot.core.internalDebugLog(de.biancoroyal.opcua.iiot.core.os.hostname()),de.biancoroyal.opcua.iiot.core.internalDebugLog(de.biancoroyal.opcua.iiot.core.os.platform()),de.biancoroyal.opcua.iiot.core.internalDebugLog(de.biancoroyal.opcua.iiot.core.os.type()),de.biancoroyal.opcua.iiot.core.internalDebugLog(de.biancoroyal.opcua.iiot.core.os.arch()),de.biancoroyal.opcua.iiot.core.getPathFromRequireResolve=function(e){var a="";return a=this.isWindows?e.replace("\\index.js",""):e.replace("/index.js",""),this.internalDebugLog("path to node-opcua: "+a),a},de.biancoroyal.opcua.iiot.core.getNodeOPCUAPath=function(){return this.getPathFromRequireResolve(require.resolve("node-opcua"))},de.biancoroyal.opcua.iiot.core.getNodeOPCUAClientPath=function(){return this.getPathFromRequireResolve(require.resolve("node-opcua-client"))},de.biancoroyal.opcua.iiot.core.getNodeOPCUAServerPath=function(){return this.getPathFromRequireResolve(require.resolve("node-opcua-server"))},de.biancoroyal.opcua.iiot.core.getTimeUnitName=function(e){var a="";switch(e){case"ms":a="msec.";break;case"s":a="sec.";break;case"m":a="min.";break;case"h":a="h."}return a},de.biancoroyal.opcua.iiot.core.calcMillisecondsByTimeAndUnit=function(e,a){var o;switch(a){case"ms":o=e;break;case"s":o=1e3*e;break;case"m":o=6e4*e;break;case"h":o=36e5*e;break;default:o=1e4}return o},de.biancoroyal.opcua.iiot.core.buildBrowseMessage=function(e){return{topic:e,nodeId:"",browseName:"",nodeClassType:"",typeDefinition:"",payload:""}},de.biancoroyal.opcua.iiot.core.toInt32=function(e){var a=e;return a>=Math.pow(2,15)?a=e-Math.pow(2,16):a},de.biancoroyal.opcua.iiot.core.getNodeStatus=function(e,a){var o="yellow",t="ring";switch(e){case"initialize":case"connecting":o="yellow";break;case"connected":case"keepalive":case"subscribe":case"started":a||(e="active",t="dot"),o="green";break;case"active":case"subscribed":case"listening":o="green",t="dot";break;case"disconnected":case"terminated":o="red";break;case"waiting":o="blue",t="dot",e="waiting ...";break;case"error":o="red",t="dot";break;default:e||(o="blue",e="waiting ...")}return{fill:o,shape:t,status:e}},de.biancoroyal.opcua.iiot.core.buildNewVariant=function(e,a,o,t){var i=this.nodeOPCUA,n=null;switch(o=o||i.VariantArrayType.Scalar,this.detailDebugLog("buildNewVariant datatype: "+e+" value:"+a),o){case"Matrix":case i.VariantArrayType.Matrix:n=this.buildNewMatrixVariant(e,a,t);break;case"Array":case i.VariantArrayType.Array:n=this.buildNewArrayVariant(e,a);break;default:n=this.buildNewScalarVariant(e,a)}return this.detailDebugLog("buildNewVariant variantValue: "+JSON.stringify(n)),n},de.biancoroyal.opcua.iiot.core.flattenMatrixValue=function(e,a,o,t){if(t=t||[],o=o||0,Array.isArray(e)){if(0===e.length)throw new Error("Matrix cannot have zero length dimensions");if(a.length===o)a.push(e.length);else if(a[o]!==e.length)throw new Error("Matrix subtitems need to be of an equal size");for(var i=0;i<e.length;i++)this.flattenMatrixValue(e[i],a,o+1,t)}else t.push(e);return t},de.biancoroyal.opcua.iiot.core.buildNewMatrixVariant=function(e,a,o){var t=this.nodeOPCUA;if(!Array.isArray(a))throw new Error("Non array value provided to an matrix type node");var i=[],n=this.flattenMatrixValue(a,i);if(o=o||i,!i.every(function(e,a){return e===o[a]})&&i[0]!==o.reduce(function(e,a){return e*a}))throw new Error("Given matrix dimensions do not match the number of values");var r=de.biancoroyal.opcua.iiot.core.buildNewArrayVariant(e,n);return r.arrayType=t.VariantArrayType.Matrix,r.dimensions=o,r},de.biancoroyal.opcua.iiot.core.buildNewArrayVariant=function(a,o){var t=this.nodeOPCUA,i=null;if(!Array.isArray(o))throw new Error("Non array value provided to an array type node");switch(a){case"Float":case t.DataType.Float:i={dataType:t.DataType.Float,arrayType:t.VariantArrayType.Array,value:[]};for(var e=0;e<o.length;e++)i.value.push(parseFloat(o[e]));break;case"Double":case t.DataType.Double:i={dataType:t.DataType.Double,arrayType:t.VariantArrayType.Array,value:[]};for(var n=0;n<o.length;n++)i.value.push(parseFloat(o[n]));break;case"UInt16":case t.DataType.UInt16:var r=new Uint16Array(o);i={dataType:t.DataType.UInt16,arrayType:t.VariantArrayType.Array,value:r};break;case"UInt32":case t.DataType.UInt32:var c=new Uint32Array(o);i={dataType:t.DataType.UInt32,arrayType:t.VariantArrayType.Array,value:c};break;case"Int32":case t.DataType.Int32:i={dataType:t.DataType.Int32,arrayType:t.VariantArrayType.Array,value:[]};for(var s=0;s<o.length;s++)i.value.push(parseInt(o[s]));break;case"Int16":case t.DataType.Int16:i={dataType:t.DataType.Int16,arrayType:t.VariantArrayType.Array,value:[]};for(var d=0;d<o.length;d++)i.value.push(parseInt(o[d]));break;case"Int64":case t.DataType.Int64:i={dataType:t.DataType.Int64,arrayType:t.VariantArrayType.Array,value:[]};for(var l=0;l<o.length;l++)i.value.push(parseInt(o[l]));break;case"Boolean":case t.DataType.Boolean:i={dataType:t.DataType.Boolean,arrayType:t.VariantArrayType.Array,value:[]};for(var u=0;u<o.length;u++)o[u]&&"false"!==o[u]&&"0"!==o[u]?i.value.push(!0):i.value.push(!1);break;case"LocalizedText":case t.DataType.LocalizedText:i={dataType:t.DataType.LocalizedText,arrayType:t.VariantArrayType.Array,value:[]};for(var y=0;y<o.length;y++)i.value.push(JSON.parse(o[y]));break;case"DateTime":case t.DataType.DateTime:i={dataType:t.DataType.DateTime,arrayType:t.VariantArrayType.Array,value:[]};for(var p=0;p<o.length;p++)i.value.push(new Date(o[p]));break;default:if(""!==a)this.getBasicDataTypes().forEach(function(e){e.name!==a&&e.dataType!==a||(i={dataType:e.dataType,arrayType:t.VariantArrayType.Array,value:o})});else i={dataType:t.DataType.String,arrayType:t.VariantArrayType.Array,value:o}}return i},de.biancoroyal.opcua.iiot.core.buildNewScalarVariant=function(a,o){var e=this.nodeOPCUA,t=null;switch(a){case"Float":case e.DataType.Float:t={dataType:e.DataType.Float,value:parseFloat(o)};break;case"Double":case e.DataType.Double:t={dataType:e.DataType.Double,value:parseFloat(o)};break;case"UInt16":case e.DataType.UInt16:var i=new Uint16Array([o]);t={dataType:e.DataType.UInt16,value:i[0]};break;case"UInt32":case e.DataType.UInt32:var n=new Uint32Array([o]);t={dataType:e.DataType.UInt32,value:n[0]};break;case"Int32":case e.DataType.Int32:t={dataType:e.DataType.Int32,value:parseInt(o)};break;case"Int16":case e.DataType.Int16:t={dataType:e.DataType.Int16,value:parseInt(o)};break;case"Int64":case e.DataType.Int64:t={dataType:e.DataType.Int64,value:parseInt(o)};break;case"Boolean":case e.DataType.Boolean:t=o&&"false"!==o&&"0"!==o?{dataType:e.DataType.Boolean,value:!0}:{dataType:e.DataType.Boolean,value:!1};break;case"LocalizedText":case e.DataType.LocalizedText:t={dataType:e.DataType.LocalizedText,value:JSON.parse(o)};break;case"DateTime":case e.DataType.DateTime:t={dataType:e.DataType.DateTime,value:new Date(o)};break;default:if(""!==a)this.getBasicDataTypes().forEach(function(e){e.name!==a&&e.dataType!==a||(t={dataType:e.dataType,value:o})});else t={dataType:e.DataType.String,value:o}}return t},de.biancoroyal.opcua.iiot.core.getVariantValue=function(e,a){var o=this.nodeOPCUA;switch(e){case"UInt16":case o.DataType.UInt16:return new Uint16Array([a])[0];case"UInt32":case o.DataType.UInt32:return new Uint32Array([a])[0];case"Int16":case o.DataType.Int16:case"Int32":case o.DataType.Int32:case"Integer":case"Int64":case o.DataType.Int64:case"UInt64":case o.DataType.UInt64:return Number(a);case"Boolean":case o.DataType.Boolean:return a&&"false"!==a&&"0"!==a;case"DateTime":case o.DataType.DateTime:return new Date(a);case"String":case o.DataType.String:return"string"!=typeof a?a.toString():a;default:return a}},de.biancoroyal.opcua.iiot.core.getBasicDataTypes=function(){var e=this.nodeOPCUA;return[{name:"Null",dataType:e.DataType.Null},{name:"Boolean",dataType:e.DataType.Boolean},{name:"SByte",dataType:e.DataType.SByte},{name:"Byte",dataType:e.DataType.Byte},{name:"Int16",dataType:e.DataType.Int16},{name:"UInt16",dataType:e.DataType.UInt16},{name:"Int32",dataType:e.DataType.Int32},{name:"UInt32",dataType:e.DataType.UInt32},{name:"Int64",dataType:e.DataType.Int64},{name:"UInt64",dataType:e.DataType.UInt64},{name:"Float",dataType:e.DataType.Float},{name:"Double",dataType:e.DataType.Double},{name:"DateTime",dataType:e.DataType.DateTime},{name:"String",dataType:e.DataType.String},{name:"Guid",dataType:e.DataType.Guid},{name:"ByteString",dataType:e.DataType.ByteString},{name:"XmlElement",dataType:e.DataType.XmlElement},{name:"NodeId",dataType:e.DataType.NodeId},{name:"ExpandedNodeId",dataType:e.DataType.ExpandedNodeId},{name:"StatusCode",dataType:e.DataType.StatusCode},{name:"LocalizedText",dataType:e.DataType.LocalizedText},{name:"ExtensionObject",dataType:e.DataType.ExtensionObject},{name:"DataValue",dataType:e.DataType.DataValue},{name:"Variant",dataType:e.DataType.Variant},{name:"DiagnosticInfo",dataType:e.DataType.DiagnosticInfo}]},de.biancoroyal.opcua.iiot.core.convertDataValue=function(e){return de.biancoroyal.opcua.iiot.core.convertDataValueByDataType(e,e.dataType)},de.biancoroyal.opcua.iiot.core.convertDataValueByDataType=function(e,a){var o=this.nodeOPCUA,t=null;if(!e.hasOwnProperty("value"))return this.specialDebugLog("value has no value and that is not allowed "+JSON.stringify(e)),e;var i=_typeof(e.value);this.detailDebugLog("convertDataValue: "+JSON.stringify(e)+" value origin type "+i+" convert to "+a);try{switch(a){case"NodeId":case o.DataType.NodeId:t=e.value.toString();break;case"NodeIdType":case o.DataType.NodeIdType:t=e.value instanceof Buffer?e.value.toString():e.value;break;case"ByteString":case o.DataType.ByteString:t=e.value;break;case"Byte":case o.DataType.Byte:t="boolean"===i?e.value?1:0:parseInt(e.value);break;case o.DataType.QualifiedName:t=e.value.toString();break;case"LocalizedText":case o.DataType.LocalizedText:t=e.value;break;case"Float":case o.DataType.Float:t=isNaN(e.value)?e.value:parseFloat(e.value);break;case"Double":case o.DataType.Double:t=isNaN(e.value)?e.value:parseFloat(e.value);break;case"UInt16":case o.DataType.UInt16:t=new Uint16Array([e.value])[0];break;case"UInt32":case o.DataType.UInt32:t=new Uint32Array([e.value])[0];break;case"Int16":case o.DataType.Int16:case"Int32":case o.DataType.Int32:case"Int64":case o.DataType.Int64:t="boolean"===i?e.value?1:0:isNaN(e.value)?e.value:parseInt(e.value);break;case"Boolean":case o.DataType.Boolean:t=e.value;break;case"String":case o.DataType.String:t="string"!==i?e.value.toString():e.value;break;case"Null":case o.DataType.Null:t=null;break;default:this.internalDebugLog("convertDataValue unused DataType: "+a),t=e.hasOwnProperty("value")?e.value:null}}catch(e){this.detailDebugLog("convertDataValue "+e)}return this.detailDebugLog("convertDataValue is: "+t),t},de.biancoroyal.opcua.iiot.core.regex_ns_i=/ns=([0-9]+);i=([0-9]+)/,de.biancoroyal.opcua.iiot.core.regex_ns_s=/ns=([0-9]+);s=(.*)/,de.biancoroyal.opcua.iiot.core.regex_ns_b=/ns=([0-9]+);b=(.*)/,de.biancoroyal.opcua.iiot.core.regex_ns_g=/ns=([0-9]+);g=(.*)/,de.biancoroyal.opcua.iiot.core.parseNamspaceFromMsgTopic=function(e){var a=null;return e&&e.topic&&(a=e.topic.substring(3,e.topic.indexOf(";"))),a},de.biancoroyal.opcua.iiot.core.parseNamspaceFromItemNodeId=function(e){var a=null,o=e.nodeId||e;return o&&(a=o.substring(3,o.indexOf(";"))),a},de.biancoroyal.opcua.iiot.core.parseForNodeIdentifier=function(e){var a=null;return e&&(a=e.includes(";i=")?{identifier:parseInt(e.substring(e.indexOf(";i=")+3)),type:de.biancoroyal.opcua.iiot.core.nodeOPCUAId.NodeIdType.NUMERIC}:e.includes(";g=")?{identifier:e.substring(e.indexOf(";g=")+3),type:de.biancoroyal.opcua.iiot.core.nodeOPCUAId.NodeIdType.GUID}:e.includes(";b=")?{identifier:e.substring(e.indexOf(";b=")+3),type:de.biancoroyal.opcua.iiot.core.nodeOPCUAId.NodeIdType.BYTESTRING}:{identifier:e.substring(e.indexOf(";s=")+3),type:de.biancoroyal.opcua.iiot.core.nodeOPCUAId.NodeIdType.STRING}),a},de.biancoroyal.opcua.iiot.core.parseIdentifierFromMsgTopic=function(e){return this.parseForNodeIdentifier(e.topic)},de.biancoroyal.opcua.iiot.core.parseIdentifierFromItemNodeId=function(e){return this.parseForNodeIdentifier(e.nodeId||e)},de.biancoroyal.opcua.iiot.core.newOPCUANodeIdFromItemNodeId=function(e){var a=this.parseNamspaceFromItemNodeId(e),o=this.parseIdentifierFromItemNodeId(e);return this.internalDebugLog("newOPCUANodeIdFromItemNodeId: "+JSON.stringify(e)+" -> "+JSON.stringify(o)+" namespace:"+a),new de.biancoroyal.opcua.iiot.core.nodeOPCUAId.NodeId(o.type,o.identifier,a)},de.biancoroyal.opcua.iiot.core.newOPCUANodeIdFromMsgTopic=function(e){var a=this.parseNamspaceFromMsgTopic(e),o=this.parseIdentifierFromMsgTopic(e);return this.internalDebugLog("newOPCUANodeIdFromMsgTopic: "+JSON.stringify(o)),new de.biancoroyal.opcua.iiot.core.nodeOPCUAId.NodeId(o.type,o.identifier,a)},de.biancoroyal.opcua.iiot.core.pushItemToWriteList=function(e,a,o,t){var i=this.nodeOPCUA;a.push({nodeId:this.newOPCUANodeIdFromItemNodeId(o),attributeId:i.AttributeIds.Value,indexRange:null,value:t})},de.biancoroyal.opcua.iiot.core.buildNodesToWrite=function(e){var a=[];this.detailDebugLog("buildNodesToWrite input: "+JSON.stringify(e));var o=null;if(!e.addressSpaceItems||!e.addressSpaceItems.length){var t=e.payload.nodesToWrite||e.nodesToWrite;t&&t.length&&(e.addressSpaceItems=t)}if(e.addressSpaceItems){var i=0;if(e.valuesToWrite){var n=!0,r=!1,c=void 0;try{for(var s,d=e.addressSpaceItems[Symbol.iterator]();!(n=(s=d.next()).done);n=!0)o=s.value,this.pushItemToWriteList(e,a,o,{value:this.buildNewVariant(o.datatypeName,e.valuesToWrite[i++],o.arraytypeName,o.dimensions)})}catch(e){r=!0,c=e}finally{try{n||null==d.return||d.return()}finally{if(r)throw c}}}else{var l=!0,u=!1,y=void 0;try{for(var p,T=e.addressSpaceItems[Symbol.iterator]();!(l=(p=T.next()).done);l=!0)(o=p.value).value?this.pushItemToWriteList(e,a,o,{value:this.buildNewVariant(o.datatypeName,o.value,o.arraytypeName,o.dimensions)}):this.pushItemToWriteList(e,a,o,{value:this.buildNewVariant(o.datatypeName,e.payload.length&&e.payload.length===e.addressSpaceItems.length?e.payload[i++]:e.payload,o.arraytypeName,o.dimensions)})}catch(e){u=!0,y=e}finally{try{l||null==T.return||T.return()}finally{if(u)throw y}}}}return this.internalDebugLog("buildNodesToWrite output: "+JSON.stringify(a)),a},de.biancoroyal.opcua.iiot.core.buildNodesToRead=function(e){var a=[],o=null;this.detailDebugLog("buildNodesToRead input: "+JSON.stringify(e));var t=e.payload.nodesToRead||e.payload.nodesToWrite;if(t&&t.length){var i=!0,n=!1,r=void 0;try{for(var c,s=t[Symbol.iterator]();!(i=(c=s.next()).done);i=!0)o=(o=c.value).nodeId||o,a.push(o.toString())}catch(e){n=!0,r=e}finally{try{i||null==s.return||s.return()}finally{if(n)throw r}}}else{var d=e.nodesToRead||e.nodesToWrite;if(d&&d.length){var l=!0,u=!1,y=void 0;try{for(var p,T=d[Symbol.iterator]();!(l=(p=T.next()).done);l=!0)o=(o=p.value).nodeId||o,a.push(o.toString())}catch(e){u=!0,y=e}finally{try{l||null==T.return||T.return()}finally{if(u)throw y}}}else if(e.payload.addressSpaceItems&&e.payload.addressSpaceItems.length){var b=!0,h=!1,I=void 0;try{for(var f,g=e.payload.addressSpaceItems[Symbol.iterator]();!(b=(f=g.next()).done);b=!0)o=f.value,a.push(o.nodeId)}catch(e){h=!0,I=e}finally{try{b||null==g.return||g.return()}finally{if(h)throw I}}}else if(e.addressSpaceItems&&e.addressSpaceItems.length){var N=!0,v=!1,m=void 0;try{for(var D,S=e.addressSpaceItems[Symbol.iterator]();!(N=(D=S.next()).done);N=!0)o=D.value,a.push(o.nodeId)}catch(e){v=!0,m=e}finally{try{N||null==S.return||S.return()}finally{if(v)throw m}}}}return this.internalDebugLog("buildNodesToRead output: "+JSON.stringify(a)),a},de.biancoroyal.opcua.iiot.core.buildNodesToListen=function(e){return e.addressItemsToRead||e.addressSpaceItems},de.biancoroyal.opcua.iiot.core.buildNodesFromBrowser=function(e){return e.payload.browserResults||e.addressSpaceItems},de.biancoroyal.opcua.iiot.core.buildNodesFromCrawler=function(e){return e.payload.crawlerResults||e.addressSpaceItems},de.biancoroyal.opcua.iiot.core.buildNodeListFromClient=function(e){switch(e.nodetype){case"read":case"write":return this.buildNodesToRead(e);case"listen":return this.buildNodesToListen(e);case"browse":return this.buildNodesFromBrowser(e);case"crawl":return this.buildNodesFromCrawler(e);default:return this.internalDebugLog("unknown node type injected to filter for "+e.nodetype),[]}},de.biancoroyal.opcua.iiot.core.availableMemory=function(){return this.os.freemem()/this.os.totalmem()*100},de.biancoroyal.opcua.iiot.core.isSessionBad=function(e){return e.toString().includes("Session")||e.toString().includes("Channel")||e.toString().includes("Transaction")||e.toString().includes("timeout")||e.toString().includes("Connection")},de.biancoroyal.opcua.iiot.core.setNodeInitalState=function(e,a){switch(e){case"INITOPCUA":case"SESSIONREQUESTED":this.setNodeStatusTo(a,"connecting");break;case"OPEN":case"SESSIONCLOSED":a.bianco.iiot.opcuaClient=a.connector.bianco.iiot.opcuaClient,this.setNodeStatusTo(a,"connected");break;case"SESSIONACTIVE":a.bianco.iiot.opcuaSession=a.connector.bianco.iiot.opcuaSession,this.setNodeStatusTo(a,"active");break;case"LOCKED":this.setNodeStatusTo(a,"locked");break;case"UNLOCKED":this.setNodeStatusTo(a,"unlocked");break;case"STOPPED":this.setNodeStatusTo(a,"stopped");break;case"END":this.setNodeStatusTo(a,"end");break;default:this.setNodeStatusTo(a,"waiting")}},de.biancoroyal.opcua.iiot.core.isNodeId=function(e){if(!e||!e.identifierType)return!1;switch(e.identifierType){case this.nodeOPCUA.NodeIdType.NUMERIC:case this.nodeOPCUA.NodeIdType.STRING:case this.nodeOPCUA.NodeIdType.GUID:return!0;default:return!1}},de.biancoroyal.opcua.iiot.core.checkConnectorState=function(e,a,o){return this.internalDebugLog("Check Connector State "+e.connector.bianco.iiot.stateMachine.getMachineState()+" By "+o),!e.connector||!e.connector.bianco.iiot.stateMachine||e.connector.bianco.iiot.stateMachine.getMachineState()===this.RUNNING_STATE||(this.internalDebugLog("Wrong Client State "+e.connector.bianco.iiot.stateMachine.getMachineState()+" By "+o),e.showErrors&&e.error(new Error("Client Not "+this.RUNNING_STATE+" On "+o),a),this.setNodeStatusTo(e,"not running"),e.emit("opcua_client_not_ready"),!1)},de.biancoroyal.opcua.iiot.core.setNodeOPCUAConnected=function(e,a){this.isInitializedBiancoIIoTNode(e)&&(e.bianco.iiot.opcuaClient=a),this.setNodeStatusTo(e,"connecting")},de.biancoroyal.opcua.iiot.core.setNodeOPCUAClosed=function(e){this.isInitializedBiancoIIoTNode(e)&&(e.bianco.iiot.opcuaClient=null),this.setNodeStatusTo(e,"disconnected")},de.biancoroyal.opcua.iiot.core.setNodeOPCUALost=function(e){this.setNodeStatusTo(e,"lost")},de.biancoroyal.opcua.iiot.core.setNodeOPCUASessionStarted=function(e,a){this.isInitializedBiancoIIoTNode(e)&&(e.bianco.iiot.opcuaSession=a),this.setNodeStatusTo(e,"active")},de.biancoroyal.opcua.iiot.core.setNodeOPCUASessionClosed=function(e){this.isInitializedBiancoIIoTNode(e)&&(e.bianco.iiot.opcuaSession=null),this.setNodeStatusTo(e,"connecting")},de.biancoroyal.opcua.iiot.core.setNodeOPCUASessionRestart=function(e){this.setNodeStatusTo(e,"restart")},de.biancoroyal.opcua.iiot.core.setNodeOPCUASessionError=function(e){this.isInitializedBiancoIIoTNode(e)&&(e.bianco.iiot.opcuaSession=null),this.setNodeStatusTo(e,"connecting")},de.biancoroyal.opcua.iiot.core.setNodeOPCUARestart=function(e,a){this.internalDebugLog("Connector Restart"),a&&this.isInitializedBiancoIIoTNode(e)&&(e.bianco.iiot.opcuaClient=a),this.setNodeStatusTo(e,"connecting")},de.biancoroyal.opcua.iiot.core.registerToConnector=function(a){var o=this;this.isInitializedBiancoIIoTNode(a)?this.isInitializedBiancoIIoTNode(a.connector)?(a.connector.bianco.iiot.registerForOPCUA(a),a.connector.on("connector_init",function(){a.bianco.iiot.opcuaClient&&(a.bianco.iiot.opcuaClient=null),a.bianco.iiot.opcuaSession&&(a.bianco.iiot.opcuaSession=null)}),a.connector.on("connection_started",function(e){o.setNodeOPCUAConnected(a,e)}),a.connector.on("server_connection_close",function(){o.setNodeOPCUAClosed(a)}),a.connector.on("server_connection_abort",function(){o.setNodeOPCUAClosed(a)}),a.connector.on("connection_closed",function(){o.setNodeOPCUAClosed(a)}),a.connector.on("server_connection_lost",function(){o.setNodeOPCUALost(a)}),a.connector.on("reset_opcua_connection",function(){o.setNodeOPCUASessionClosed(a)}),a.connector.on("session_started",function(e){o.setNodeOPCUASessionStarted(a,e)}),a.connector.on("session_closed",function(){o.setNodeOPCUASessionClosed(a)}),a.connector.on("session_restart",function(){o.setNodeOPCUAClosed(a)}),a.connector.on("session_error",function(){o.setNodeOPCUASessionError(a)}),a.connector.on("after_reconnection",function(){o.setNodeOPCUARestart(a)}),o.setNodeInitalState(a.connector.bianco.iiot.stateMachine.getMachineState(),a)):a.error(new Error("Connector Config Node Not Valid On Registering Client Node "+a.id),{payload:"No Connector Configured"}):o.internalDebugLog("Node Not Valid On Register To Connector")},de.biancoroyal.opcua.iiot.core.deregisterToConnector=function(e,a){e?e.connector?(e.connector.removeAllListeners(),this.isInitializedBiancoIIoTNode(e.connector)?e.connector.bianco.iiot.deregisterForOPCUA(e,a):a()):(e.error(new Error("Connector Not Valid On Register To Connector"),{payload:"No Connector Configured"}),a()):(this.internalDebugLog("Node Not Valid On Register To Connector"),a())},de.biancoroyal.opcua.iiot.core.checkSessionNotValid=function(e,a){return e?"terminated"===e.sessionId&&(this.internalDebugLog("Session Is Valid But Terminated On Check For "+a),!0):(this.internalDebugLog("Session Not Valid On Check For "+a),!0)},de.biancoroyal.opcua.iiot.core.setNodeStatusTo=function(e,a){var o=this.getNodeStatus(a,e.showStatusActivities);this.underscore.isEqual(e.oldStatusParameter,o)||(this.detailDebugLog("Node "+e.id+" Status To "+a),e.oldStatusParameter=o,e.status({fill:o.fill,shape:o.shape,text:o.status}))},de.biancoroyal.opcua.iiot.core.createBiancoIIoT=function(){return{iiot:{}}},de.biancoroyal.opcua.iiot.core.initClientNode=function(e){return e.bianco=this.createBiancoIIoT(),e.bianco.iiot.reconnectTimeout=this.DEFAULT_TIMEOUT,e.bianco.iiot.sessionTimeout=null,e.bianco.iiot.opcuaSession=null,e.bianco.iiot.opcuaClient=null,e},de.biancoroyal.opcua.iiot.core.initCoreServerNode=function(e){return e.bianco=this.createBiancoIIoT(),e.bianco.iiot.initialized=!1,e.bianco.iiot.opcuaServer=null,e},de.biancoroyal.opcua.iiot.core.getItemFilterValueWithElement=function(e,a){var o=null;switch(a.name){case"browseName":case"statusCode":o=e[a.name].name;break;case"displayName":o=e[a.name].text;break;case"value":case"dataType":o=e.value&&e.value.hasOwnProperty("value")?e.value[a.name]:e[a.name];break;default:o=e[a.name]}return o},de.biancoroyal.opcua.iiot.core.handleErrorInsideNode=function(e,a){this.internalDebugLog(_typeof(e)+" "+a.message),e.showErrors&&e.error(a,{payload:a.message})},de.biancoroyal.opcua.iiot.core.checkCrawlerItemIsNotToFilter=function(a,e,o,t){try{var i=this.getItemFilterValueWithElement(e,o);i&&i.key&&i.key.match?i.key.match(o.value)&&(t&=!1):i&&i.match?i.match(o.value)&&(t&=!1):i&&i.toString&&(i=i.toString())&&i.match&&i.match(o.value)&&(t&=!1)}catch(e){this.handleErrorInsideNode(a,e)}return t},de.biancoroyal.opcua.iiot.core.checkResponseItemIsNotToFilter=function(a,e,o,t){try{var i=this.getItemFilterValueWithElement(e,o);i?i.key&&i.key.match?t&=null!==i.key.match(o.value):i.match?t&=null!==i.match(o.value):i.toString&&(i=i.toString()).match&&(t&=null!==i.match(o.value)):t&=!1}catch(e){this.handleErrorInsideNode(a,e)}return t},de.biancoroyal.opcua.iiot.core.checkItemForUnsetState=function(e,a){var o=!0;return e.activateUnsetFilter&&(o&=null!==a,a&&a.hasOwnProperty("value")&&(a.value&&a.value.hasOwnProperty("value")?o&=null!==a.value.value:o&=null!==a.value)),o},de.biancoroyal.opcua.iiot.core.resetBiancoNode=function(e){this.isInitializedBiancoIIoTNode(e)&&e.bianco.iiot.resetAllTimer&&e.bianco.iiot.resetAllTimer(),this.isInitializedBiancoIIoTNode(e)&&(e.bianco.iiot=null),e.bianco=null},de.biancoroyal.opcua.iiot.core.filterListEntryByNodeId=function(a,e){var o=[];return e&&e.length&&e.forEach(function(e){e===a&&o.push(e)}),o},de.biancoroyal.opcua.iiot.core.filterListByNodeId=function(a,e){var o=[];return e&&e.length&&e.forEach(function(e){e.nodeId===a&&o.push(e)}),o},de.biancoroyal.opcua.iiot.core.isNodeTypeToFilterResponse=function(e){return"read"===e.nodetype||"browse"===e.nodetype||"crawl"===e.nodetype||"method"===e.nodetype},de.biancoroyal.opcua.iiot.core.isInitializedBiancoIIoTNode=function(e){return e&&e.bianco&&e.bianco.iiot},module.exports=de.biancoroyal.opcua.iiot.core;
//# sourceMappingURL=../maps/core/opcua-iiot-core.js.map
