"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}require("source-map-support").install();var de=de||{biancoroyal:{opcua:{iiot:{core:{browser:{crawler:{}}}}}}};de.biancoroyal.opcua.iiot.core.browser.core=de.biancoroyal.opcua.iiot.core.browser.core||require("./opcua-iiot-core"),de.biancoroyal.opcua.iiot.core.browser.internalDebugLog=de.biancoroyal.opcua.iiot.core.browser.internalDebugLog||require("debug")("opcuaIIoT:browser"),de.biancoroyal.opcua.iiot.core.browser.detailDebugLog=de.biancoroyal.opcua.iiot.core.browser.detailDebugLog||require("debug")("opcuaIIoT:browser:details"),de.biancoroyal.opcua.iiot.core.browser.crawler.internalDebugLog=de.biancoroyal.opcua.iiot.core.browser.crawler.internalDebugLog||require("debug")("opcuaIIoT:browser:crawler"),de.biancoroyal.opcua.iiot.core.browser.crawler.detailDebugLog=de.biancoroyal.opcua.iiot.core.browser.crawler.detailDebugLog||require("debug")("opcuaIIoT:browser:crawler:details"),de.biancoroyal.opcua.iiot.core.browser.browse=function(n,r){var i=this;return new Promise(function(t,o){var e=[{nodeId:r,referenceTypeId:"Organizes",includeSubtypes:!0,browseDirection:i.core.nodeOPCUA.browse_service.BrowseDirection.Forward,resultMask:63},{nodeId:r,referenceTypeId:"Aggregates",includeSubtypes:!0,browseDirection:i.core.nodeOPCUA.browse_service.BrowseDirection.Forward,resultMask:63}];n.requestedMaxReferencesPerNode=5e3,n.browse(e,function(e,i){e?o(e):function(){var o=[];o.push(i);for(var r=i.continuationPoint;r;)n.browseNext(r,!1).then(function(e){o.push(e),r=e.continuationPoint});t(o)}()})})},de.biancoroyal.opcua.iiot.core.browser.browseAddressSpaceItems=function(n,e){var i=this;return new Promise(function(t,o){var r=[];e.forEach(function(e){r.push({nodeId:e.nodeId,referenceTypeId:"Organizes",includeSubtypes:!0,browseDirection:i.core.nodeOPCUA.browse_service.BrowseDirection.Forward,resultMask:63}),r.push({nodeId:e.nodeId,referenceTypeId:"Aggregates",includeSubtypes:!0,browseDirection:i.core.nodeOPCUA.browse_service.BrowseDirection.Forward,resultMask:63})}),n.browse(r,function(e,i){e?o(e):function(){var o=[];o.push(i);for(var r=i.continuationPoint;r;)n.browseNext(r,!1).then(function(e){o.push(e),r=e.continuationPoint});t(o)}()})})},de.biancoroyal.opcua.iiot.core.browser.createCrawler=function(e){return this.core.assert(null!==e),new this.core.nodeOPCUA.NodeCrawler(e)},de.biancoroyal.opcua.iiot.core.browser.crawl=function(a,c,s){var u=this;return new Promise(function(o,r){if(c){var i=Object.assign({},s),e=u.createCrawler(a),t=[],n={onBrowse:function(e,o){t.push(o),u.core.nodeOPCUA.NodeCrawler.follow(e,o,this)}};e.crawl(c,n,function(e){e?r(e):o({rootNodeId:c,message:i,crawlerResult:t})})}else r(new Error("NodeId To Crawl Not Valid"))})},de.biancoroyal.opcua.iiot.core.browser.crawlAddressSpaceItems=function(o,c){var s=this;return new Promise(function(r,i){if(c.addressSpaceItems){var t=Object.assign({},c),e=s.createCrawler(o),n=[],a={onBrowse:function(e,o){o||s.internalDebugLog("Item Not To Crawl - Missing NodeId"),n.push(o),s.core.nodeOPCUA.NodeCrawler.follow(e,o,this)}};t.addressSpaceItems.forEach(function(o){o.nodeId?e.crawl(o.nodeId,a,function(e){e?i(e):r({rootNodeId:o.nodeId,message:t,crawlerResult:n})}):s.internalDebugLog("Item Not To Crawl - Missing NodeId")})}else i(new Error("AddressSpace Items Not Valid To Crawl"))})},de.biancoroyal.opcua.iiot.core.browser.browseToRoot=function(){return this.detailDebugLog("Browse To Root "+this.core.OBJECTS_ROOT),this.core.OBJECTS_ROOT},de.biancoroyal.opcua.iiot.core.browser.extractNodeIdFromTopic=function(e,o){var r=null;return"browse"===e.payload.actiontype&&(r=e.payload.root&&e.payload.root.nodeId?(this.internalDebugLog("Root Selected External "+e.payload.root),e.payload.root.nodeId):o.nodeId,this.detailDebugLog("Extracted NodeId "+r),r=r||this.browseToRoot()),r},de.biancoroyal.opcua.iiot.core.browser.transformToEntry=function(o){if(o)try{return o.toJSON()}catch(e){if(this.internalDebugLog(e),o.referenceTypeId)return{referenceTypeId:o.referenceTypeId.toString(),isForward:o.isForward,nodeId:o.nodeId.toString(),browseName:o.browseName.toString(),displayName:o.displayName.toString(),nodeClass:o.nodeClass.toString(),typeDefinition:o.typeDefinition.toString()}}else this.internalDebugLog("Empty Reference On Browse");return o},de.biancoroyal.opcua.iiot.core.browser.initBrowserNode=function(e){return this.core.initClientNode(e),e.browseTopic=this.core.OBJECTS_ROOT,e.bianco.iiot.items=[],e.bianco.iiot.messageList=[],e},de.biancoroyal.opcua.iiot.core.browser.browseErrorHandling=function(e,o,r,i){var t=i.browserResults||[];o?(this.internalDebugLog(_typeof(e)+"Error "+o),e.showErrors&&e.error(o,r),this.core.isSessionBad(o)&&e.emit("opcua_client_not_ready")):(this.internalDebugLog(_typeof(e)+" Done With Error"),t.length&&this.detailDebugLog(t.length+"items in lists of browser results")),e.showStatusActivities&&this.core.setNodeStatusTo(e,"error")},module.exports=de.biancoroyal.opcua.iiot.core.browser;
//# sourceMappingURL=../maps/core/opcua-iiot-core-browser.js.map
