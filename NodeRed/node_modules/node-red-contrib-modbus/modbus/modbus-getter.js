"use strict";module.exports=function(s){require("source-map-support").install();var o=require("./modbus-basics"),a=require("./core/modbus-core"),r=require("./core/modbus-io-core"),u=require("debug")("contribModbus:getter");s.nodes.registerType("modbus-getter",function(e){s.nodes.createNode(this,e),this.name=e.name,this.unitid=e.unitid,this.dataType=e.dataType,this.adr=e.adr,this.quantity=e.quantity,this.showStatusActivities=e.showStatusActivities,this.showErrors=e.showErrors,this.msgThruput=e.msgThruput,this.connection=null,this.useIOFile=e.useIOFile,this.ioFile=s.nodes.getNode(e.ioFile),this.useIOForPayload=e.useIOForPayload,this.logIOActivities=e.logIOActivities,this.emptyMsgOnFail=e.emptyMsgOnFail,this.internalDebugLog=u,this.verboseLogging=s.settings.verbose;var t=this;t.bufferMessageList=new Map,o.setNodeStatusTo("waiting",t);var i=s.nodes.getNode(e.server);i&&(i.registerForModbus(t),o.initModbusClientEvents(t,i),t.onModbusCommandDone=function(e,s){t.showStatusActivities&&o.setNodeStatusTo("reading done",t),t.send(r.buildMessageWithIO(t,e.data,e,s))},t.onModbusCommandError=function(e,s){u(e.message),t.showErrors&&t.error(e,s),o.emptyMsgOnFail(t,e,s),o.setModbusError(t,i,e,a.getOriginalMessage(t.bufferMessageList,s))},t.buildNewMessageObject=function(e,s){var t=Object.assign({},s);return t.topic=s.topic||e.id,t.payload={value:s.payload.value||s.payload,unitid:e.unitid,fc:a.functionCodeModbusRead(e.dataType),address:e.adr,quantity:e.quantity,messageId:s.messageId},t},t.on("input",function(e){o.invalidPayloadIn(e)||i.client&&(e.messageId=a.getObjectId(),t.bufferMessageList.set(e.messageId,e),e=t.buildNewMessageObject(t,e),i.emit("readModbus",e,t.onModbusCommandDone,t.onModbusCommandError),t.showStatusActivities&&o.setNodeStatusTo(i.actualServiceState,t))}),t.on("close",function(e){o.setNodeStatusTo("closed",t),t.bufferMessageList.clear(),i.deregisterForModbus(t,e)}))})};
//# sourceMappingURL=maps/modbus-getter.js.map
