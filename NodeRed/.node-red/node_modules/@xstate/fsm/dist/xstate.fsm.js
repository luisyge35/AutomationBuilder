var t,e;t=this,e=function(t){"use strict";var e;(e=t.InterpreterStatus||(t.InterpreterStatus={}))[e.NotStarted=0]="NotStarted",e[e.Running=1]="Running",e[e.Stopped=2]="Stopped";const n={type:"xstate.init"},i="xstate.assign";function o(t){return void 0===t?[]:[].concat(t)}function r(t,e){return"string"==typeof(t="string"==typeof t&&e&&e[t]?e[t]:t)?{type:t}:"function"==typeof t?{type:t.name,exec:t}:t}function s(t){return e=>t===e}function a(t){return"string"==typeof t?{type:t}:t}function c(t,e){return{value:t,context:e,actions:[],changed:!1,matches:s(t)}}const u=(t,e)=>t.actions.forEach(({exec:n})=>n&&n(t.context,e));t.assign=function(t){return{type:i,assignment:t}},t.createMachine=function(t,e={}){const n={config:t,_options:e,initialState:{value:t.initial,actions:o(t.states[t.initial].entry).map(t=>r(t,e.actions)),context:t.context,matches:s(t.initial)},transition:(e,u)=>{const{value:f,context:p}="string"==typeof e?{value:e,context:t.context}:e,g=a(u),d=t.states[f];if(d.on){const e=o(d.on[g.type]);for(const o of e){if(void 0===o)return c(f,p);const{target:e=f,actions:a=[],cond:u=(()=>!0)}="string"==typeof o?{target:o}:o;let l=p;if(u(p,g)){const o=t.states[e];let c=!1;const u=[].concat(d.exit,a,o.entry).filter(t=>t).map(t=>r(t,n._options.actions)).filter(t=>{if(t.type===i){c=!0;let e=Object.assign({},l);return"function"==typeof t.assignment?e=t.assignment(l,g):Object.keys(t.assignment).forEach(n=>{e[n]="function"==typeof t.assignment[n]?t.assignment[n](l,g):t.assignment[n]}),l=e,!1}return!0});return{value:e,context:l,actions:u,changed:e!==f||u.length>0||c,matches:s(e)}}}}return c(f,p)}};return n},t.interpret=function(e){let i=e.initialState,o=t.InterpreterStatus.NotStarted;const r=new Set,s={_machine:e,send:n=>{o===t.InterpreterStatus.Running&&(i=e.transition(i,n),u(i,a(n)),r.forEach(t=>t(i)))},subscribe:t=>(r.add(t),t(i),{unsubscribe:()=>r.delete(t)}),start:()=>(o=t.InterpreterStatus.Running,u(i,n),s),stop:()=>(o=t.InterpreterStatus.Stopped,r.forEach(t=>r.delete(t)),s),get status(){return o}};return s},Object.defineProperty(t,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).XStateFSM={});
